# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∫ –∑–∞–Ω—è—Ç–∏—é ¬´–û—Å–Ω–æ–≤—ã Terraform. Yandex Cloud¬ª - –ë–∞—Ä—ã—à–∫–æ–≤ –ú–∏—Ö–∞–∏–ª

## –ó–∞–¥–∞–Ω–∏–µ 1
–í –∫–∞—á–µ—Å—Ç–≤–µ –æ—Ç–≤–µ—Ç–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –≤–∞—à terraform-–∫–æ–¥ –≤ git.
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à–∞ –≤–µ—Ä—Å–∏—è **Terraform** ~>1.8.4

1. –ò–∑—É—á–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç. –í —Ñ–∞–π–ª–µ variables.tf –æ–±—ä—è–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Yandex provider.
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏ –∫–ª—é—á. [service_account_key_file](https://terraform-provider.yandexcloud.net).
4. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π —Ç–µ–∫—É—â–∏–π ssh-–∫–ª—é—á. –ó–∞–ø–∏—à–∏—Ç–µ –µ–≥–æ –æ—Ç–∫—Ä—ã—Ç—É—é(public) —á–∞—Å—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é **vms_ssh_public_root_key**.
5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–¥. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –¥–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏. –ò—â–∏—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ. –û—Ç–≤–µ—Ç—å—Ç–µ, –≤ —á—ë–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –∏—Ö —Å—É—Ç—å.
6. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –∫–æ–Ω—Å–æ–ª–∏ –í–ú —á–µ—Ä–µ–∑ ssh –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É ``` curl ifconfig.me```.
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ö OS ubuntu "out of a box, —Ç–µ –∏–∑ –∫–æ—Ä–æ–±–∫–∏" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ubuntu: ```"ssh ubuntu@vm_ip_address"```. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ ssh-–∞–≥–µ–Ω—Ç: ```eval $(ssh-agent) && ssh-add``` –í—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ—Å—å —Å —Ç–µ–º –∫–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –í–ú —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–ª–æ–∫–µ metadata –≤ —Å–ª–µ–¥—É—é—â–µ–π –ª–µ–∫—Ü–∏–∏.;
8. –û—Ç–≤–µ—Ç—å—Ç–µ, –∫–∞–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–≥—É—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ```preemptible = true``` –∏ ```core_fraction=5``` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –í–ú.

–í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–∏—Ç–µ:

- —Å–∫—Ä–∏–Ω—à–æ—Ç –õ–ö Yandex Cloud —Å —Å–æ–∑–¥–∞–Ω–Ω–æ–π –í–ú, –≥–¥–µ –≤–∏–¥–Ω–æ –≤–Ω–µ—à–Ω–∏–π ip-–∞–¥—Ä–µ—Å;
- —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏, curl –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–æ—Ç –∂–µ –≤–Ω–µ—à–Ω–∏–π ip-–∞–¥—Ä–µ—Å;
- –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.


## –†–µ—à–µ–Ω–∏–µ 1

![img1](img/img1.png)

–í Yandex Cloud –∑–Ω–∞—á–µ–Ω–∏–µ platform_id ‚Äî —ç—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞.

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è platform_id (–Ω–∞ 2024‚Äì2025 –≥.) 

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è platform_id: 

    standard-v1 ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å Intel CPU
    standard-v2 ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å Intel Ice Lake
    standard-v3 ‚Äî –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å AMD EPYC
    burstable-v1 ‚Äî burstable-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ–∫ —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º–∏ –≤—Å–ø–ª–µ—Å–∫–∞–º–∏)
    highmem-v1, highmem-v2 ‚Äî –¥–ª—è –í–ú —Å –±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –ø–∞–º—è—Ç–∏
    highcpu-v1, highcpu-v2 ‚Äî –¥–ª—è –í–ú —Å –≤—ã—Å–æ–∫–æ–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π

    üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 

–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:

```
platform_id = "standart-v4"
```

–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
platform_id = "standard-v1"
```     

–¢–∞–∫ –∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2

```
resources {
    cores         = 2
    memory        = 2
    core_fraction = 5
  }
```

–û—à–∏–±–∫–∞ –≤ –∏–º–µ–Ω–∏ –ø–æ–¥—Å–µ—Ç–∏
```
name = var.vpc_name
```

- –û—à–∏–±–∫–∞:  –∏–º—è –ø–æ–¥—Å–µ—Ç–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–º–µ–Ω–µ–º —Å–µ—Ç–∏ (vpc_name = "develop").
- –°—É—Ç—å:  —ç—Ç–æ –Ω–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è, –Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞  ‚Äî –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏.
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ): 
```
name = "${var.vpc_name}-subnet"
```

![img2](img/img2.png)

üìå preemptible = true. 



    -  –ß—Ç–æ —ç—Ç–æ:  —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –í–ú –ø—Ä–µ—Ä—ã–≤–∞–µ–º–∞—è  (preemptible).
    - –ü–æ–≤–µ–¥–µ–Ω–∏–µ:  Yandex Cloud –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–∫—É—é –í–ú –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç (–¥–æ 24 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã), –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Å—É—Ä—Å.
    - –ü–æ—á–µ–º—É –ø–æ–ª–µ–∑–Ω–æ –≤ –æ–±—É—á–µ–Ω–∏–∏: 
        - –≠–∫–æ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞  ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–µ–º—ã–µ –í–ú –¥–µ—à–µ–≤–ª–µ –Ω–∞ ~80%.
        - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏  ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤–µ–¥—ë—Ç —Å–µ–±—è –ø—Ä–∏ –≤–Ω–µ–∑–∞–ø–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–µ.
        - –ò–∑—É—á–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏  ‚Äî –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
         
üìå core_fraction = 5 

    - –ß—Ç–æ —ç—Ç–æ:  —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –í–ú –ø–æ–ª—É—á–∞–µ—Ç 5% –æ—Ç –ø–æ–ª–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ —è–¥—Ä–∞ CPU .
    - –ü–æ–≤–µ–¥–µ–Ω–∏–µ:  —Ç–∞–∫–∞—è –í–ú –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU —Ç–æ–ª—å–∫–æ –ø–æ –º–µ—Ä–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤, –Ω–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—è –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é.
    - –ü–æ—á–µ–º—É –ø–æ–ª–µ–∑–Ω–æ –≤ –æ–±—É—á–µ–Ω–∏–∏: 
        - –ò–∑—É—á–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–∞—Ö  ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–±–ª—é–¥–∞—Ç—å, –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ CPU.
        - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π  ‚Äî —Ö–æ—Ä–æ—à–∏–π –ø–æ–≤–æ–¥ –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ –∏ –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Å–∏—Å—Ç–µ–º—É.
        - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ burstable-–Ω–∞–≥—Ä—É–∑–æ–∫  ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫ –æ—Ç—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤—Å–ø–ª–µ—Å–∫–µ —Ç—Ä–∞—Ñ–∏–∫–∞.